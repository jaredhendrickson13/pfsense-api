#!/bin/sh

if [ "${2}" == "DEINSTALL" ]; then
	# Remove forms and dispatcher schedules
  /usr/local/bin/php -f /usr/local/pkg/RESTAPI/.resources/scripts/manage.php removeforms
  /usr/local/bin/php -f /usr/local/pkg/RESTAPI/.resources/scripts/manage.php unscheduledispatchers

  # Unlink this package from pfSense
  /usr/local/bin/php -f /etc/rc.packages %%PORTNAME%% POST-DEINSTALL

  # Remove the pfsense-RESTAPI command line tool
  /bin/rm /usr/local/bin/pfsense-restapi
fi

if [ "${2}" == "POST-DEINSTALL" ]; then
  # Remove other files and directories generated by the package
  printf "Removing endpoints, schemas, and caches..."
  find /usr/local/www/api/v2/ -depth 1 -not -name documentation -not -name schema -exec rm -rf {} +
  rm -rf /usr/local/www/api/v2/schema/*
  rm /usr/local/pkg/RESTAPI/.resources/cache/*
  rm /usr/local/pkg/RESTAPI/.resources/schemas/*
  printf " done.\n"
fi
